<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Academic Analytics Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- UPDATED HEADER: STEADY PURPLE + EMOJIS --- */
        .header {
            width: 100%;
            /* No Animation, just a nice Royal Purple Gradient */
            background: linear-gradient(135deg, #8E2DE2, #4A00E0);
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(74, 0, 224, 0.4);
            margin-bottom: 2rem;
        }

        .header h1 { margin: 0; font-size: 2.2rem; letter-spacing: 1px; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-weight: 300; }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 95%;
            max-width: 1000px;
            margin-bottom: 50px;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            flex: 1;
            min-width: 350px;
        }

        .input-group { margin-bottom: 15px; }
        
        label { display: block; margin-bottom: 6px; font-weight: 700; color: #444; font-size: 0.85rem; }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5ee;
            border-radius: 8px;
            transition: 0.3s;
        }
        input:focus { border-color: #4a00e0; outline: none; }

        /*.reward-input input {
            border-color: #F59E0B;
            background-color: #FFFBEB;
        }*/

        button {
            width: 100%;
            padding: 15px;
            background: #4A00E0; /* Matches Header Purple */
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover { transform: scale(1.02); background: #8E2DE2; }

        .result-container { text-align: center; }
        .chart-box { position: relative; height: 250px; width: 250px; margin: 20px auto; }
        .percent-display { font-size: 3.5rem; font-weight: 800; color: #333; line-height: 1; }
        .status-msg { font-size: 1rem; margin-top: 15px; color: #555; }
        .safe-text { color: #059669; font-weight: 600; }
        .danger-text { color: #dc2626; font-weight: 600; }

        /* VISITOR BADGE */
        .visitor-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .pulse-dot {
            height: 10px;
            width: 10px;
            background-color: #22c55e;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>üéì ACADEMIC DASHBOARD üìä</h1>
        <p>Analytics & Rewards Manager üöÄ</p>
    </div>

    <div class="main-content">
        
        <div class="card">
            <h3 style="margin-top:0; color:#444;">üìù Enter Details</h3>
            
            <form action="/calculate" method="post" onsubmit="saveData()">
                
                <div class="input-group">
                    <label>Total Classes Held</label>
                    <input type="number" id="total" name="total" placeholder="e.g., 50" th:value="${total}" required>
                </div>

                <div class="input-group">
                    <label>Absences (Missed)</label>
                    <input type="number" id="absent" name="absent" placeholder="e.g., 5" th:value="${absent} ?: 0" required>
                </div>

                <div class="input-group reward-input">
                    <label>üèÜ Delegation / Bonus Attendance</label>
                    <input type="number" id="delegation" name="delegation" placeholder="e.g., 2" th:value="${delegation} ?: 0">
                    <small style="color: #888; font-size: 0.75rem;">These points ADD to your attendance.</small>
                </div>

                <div class="input-group">
                    <label>Target Criteria (%)</label>
                    <input type="number" id="target" name="target" placeholder="90" th:value="${target} ?: 90" step="0.1">
                </div>

                <div class="input-group">
                    <label>Predicted Total To Be Held (Optional)</label>
                    <input type="number" id="futureTotal" name="futureTotal" placeholder="e.g., 100" th:value="${futureTotal}">
                </div>

                <button type="submit">Analyze Status</button>
            </form>
        </div>

        <div class="card result-container" th:if="${currentMsg}">
            <div class="chart-box">
                <canvas id="attendanceChart"></canvas>
            </div>

            <div class="percent-display" th:text="${currentPercent} + '%'"></div>
            <p class="status-msg" th:classappend="${statusColor == 'green'} ? 'safe-text' : 'danger-text'" th:text="${currentMsg}"></p>

            <div th:if="${futureMsg}" style="background:#f8fafc; padding:15px; margin-top:20px; border-radius:8px; text-align:left; border-left:4px solid #4a00e0;">
                <strong>üîÆ Future Outlook:</strong><br>
                <span th:text="${futureMsg}"></span>
            </div>
        </div>
        
        <div class="card result-container" th:unless="${currentMsg}" style="justify-content:center; color:#999;">
            <h3>üìä Analytics Waiting...</h3>
            <p>Enter your class data to calculate.</p>
        </div>
    </div>

    <div class="visitor-badge">
        <span class="pulse-dot"></span>
        <span>Visitors: <span th:text="${visitCount}">0</span></span>
    </div>

    <script th:inline="javascript">
        /*[[${currentMsg}]]*/ 
        var total = /*[[${total}]]*/ 0;
        var rawAbsent = /*[[${absent}]]*/ 0; 
        var delegation = /*[[${delegation}]]*/ 0; 

        if (total > 0) {
            var physicalAttended = total - rawAbsent;
            if (physicalAttended < 0) physicalAttended = 0;
            var effectiveAbsent = rawAbsent - delegation;
            if (effectiveAbsent < 0) effectiveAbsent = 0;

            const ctx = document.getElementById('attendanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Classes Attended', 'Bonus (Delegation)', 'Absent'],
                    datasets: [{
                        data: [physicalAttended, delegation, effectiveAbsent],
                        backgroundColor: [
                            '#1CB5E0', // Blue
                            '#F59E0B', // Gold
                            '#e01c6a'  // Pink
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function saveData() {
            localStorage.setItem('total', document.getElementById('total').value);
            localStorage.setItem('target', document.getElementById('target').value);
            localStorage.setItem('delegation', document.getElementById('delegation').value);
        }
        
        window.onload = function() {
            if(!document.getElementById('total').value) {
                if(localStorage.getItem('total')) document.getElementById('total').value = localStorage.getItem('total');
                if(localStorage.getItem('target')) document.getElementById('target').value = localStorage.getItem('target');
                if(localStorage.getItem('delegation')) document.getElementById('delegation').value = localStorage.getItem('delegation');
            }
        };
    </script>
</body>
</html>